# Remote Execution Example
# Demonstrates distributed build execution with autoscaling

# Build C++ project using remote execution
target cpp_project:
    inputs:
        - src/**/*.cpp
        - src/**/*.h
    outputs:
        - build/app
    command: |
        mkdir -p build
        g++ -std=c++17 -O2 src/*.cpp -o build/app
    hermetic:
        max_memory: 2GiB
        max_cpu: 2
        timeout: 5m
    remote: true
    
# Run tests remotely
target test:
    depends: cpp_project
    inputs:
        - build/app
        - tests/**/*.cpp
    outputs:
        - build/test_results.xml
    command: |
        g++ -std=c++17 tests/*.cpp -o build/tests
        ./build/tests --gtest_output=xml:build/test_results.xml
    hermetic:
        max_memory: 1GiB
        max_cpu: 1
        timeout: 2m
    remote: true
    cache: true

# Parallel compilation demonstration
target parallel_build:
    inputs:
        - lib/**/*.cpp
    outputs:
        - build/objects/*.o
    command: |
        for file in lib/*.cpp; do
            g++ -c "$file" -o "build/objects/$(basename "$file" .cpp).o" &
        done
        wait
    hermetic:
        max_memory: 4GiB
        max_cpu: 8
        timeout: 10m
    remote: true
    parallelism: 8

